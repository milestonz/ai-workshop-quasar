const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/QSpinnerDots-CtV_sSP1-C4uhZ7_-.js","assets/index-bfaO29LJ.js","assets/index-DJuvGez9.css"])))=>i.map(i=>d[i]);
import{gl as ge,gp as m,gq as C,gL as E,gs as ae,gx as w,gJ as n,gQ as o,gY as oe,gP as O,gK as Q,gm as Te,gt as Re,h1 as Ae,gM as T,gy as y,gw as te,go as Ee,h2 as ze,gn as He,h3 as Me,gU as Fe,gO as ie,gN as De,h4 as j,h5 as xe,X as ke,_ as Le,h6 as Pe,h7 as Ce,h8 as We,h9 as je}from"./index-bfaO29LJ.js";import{t as Ve,j as ee,e as Ie,o as qe,D as Qe}from"./QDialog-B8pEesiq-BeyHQlTP.js";import{f as Ue}from"./QBanner-Dj1wXmJN-DtFv62tq.js";import{v as Ge}from"./QPage-ByY5YaQR-DpnvW4Lw.js";import{K as b,q as Y,H as Xe,X as Ye}from"./useGuestAuth-DCU4zYbt-BkzXZq5s.js";import{Q as Be}from"./QSpinnerDots-CtV_sSP1-C4uhZ7_-.js";import{k as fe}from"./_plugin-vue_export-helper-BIy862K0-Cvk7klib.js";import{G as Je}from"./QChip-5D8RM28h-CCot4X64.js";import{H as Ze,b as Ne}from"./marked.esm-Bd18tbQr-hWC9_paR.js";import"./pinia-Bs2obeVG-Cxe1i29N.js";const pe=(M,p=pe,$=p.f||(p.f=["assets/QSpinnerDots-CtV_sSP1.js","assets/index-CyCqcZIQ.js","assets/index-D7VONvhQ.css"]))=>M.map(g=>$[g]),Ke={class:"simple-slide-viewer"},el={key:0,class:"error"},ll={key:1,class:"html-slide-container"},tl=["innerHTML"],al={key:2,class:"slide-iframe-container"},ol=["src"],sl={key:0,class:"loading-overlay"},nl={key:3,class:"no-content"},il=ge({__name:"SimpleSlideViewer",props:{slideNumber:{},slideType:{}},setup(M){const p=M,$=m(""),g=m(!1),e=m(""),S=C(()=>p.slideNumber?`/generated/slides/slide-${p.slideNumber}.html`:""),c=async()=>{if(p.slideType==="html")try{g.value=!0;const f=await fetch(`/slides/slide-${p.slideNumber}.md`);if(f.ok){const V=await f.text();e.value=V.replace(/^@html\s*\n?/gm,"").trim(),b.log(`✅ HTML 슬라이드 내용 로드 완료: ${p.slideNumber}`)}else $.value=`HTML 슬라이드 ${p.slideNumber} 로딩 중 오류가 발생했습니다.`,b.error(`HTML 슬라이드 ${p.slideNumber} 로딩 실패:`,f.status)}catch(f){$.value=`HTML 슬라이드 ${p.slideNumber} 로딩 중 오류가 발생했습니다.`,b.error(`HTML 슬라이드 ${p.slideNumber} 로딩 오류:`,f)}finally{g.value=!1}},D=()=>{g.value=!1,b.log(`✅ iframe 로드 완료: ${S.value}`)},_=f=>{$.value=`슬라이드 ${p.slideNumber} 로딩 중 오류가 발생했습니다.`,b.error(`슬라이드 ${p.slideNumber} 로딩 중 오류 발생:`,f),g.value=!1},z=()=>{g.value=!1,b.log(`✅ HTML 슬라이드 로드 완료: ${p.slideNumber}`)};return ae(()=>p.slideNumber,f=>{f&&(g.value=!0,$.value="",p.slideType==="html"?c():(b.log(`🔄 iframe URL 변경: ${S.value}`),setTimeout(()=>{g.value&&(g.value=!1,b.log("⚠️ 슬라이드 로딩 시간 초과"))},3e3)))},{immediate:!0}),(f,V)=>(w(),E("div",Ke,[$.value?(w(),E("div",el,[n(oe,{name:"error",size:"50px",color:"negative"}),o("p",null,O($.value),1)])):f.slideType==="html"&&e.value?(w(),E("div",ll,[o("div",{class:"html-slide-content",innerHTML:e.value,onLoad:z},null,40,tl)])):S.value?(w(),E("div",al,[o("iframe",{src:S.value,class:"slide-iframe",onLoad:D,onError:_},null,40,ol),g.value?(w(),E("div",sl,[n(Be,{size:"50px",color:"primary"}),V[0]||(V[0]=o("p",null,"슬라이드 로딩 중...",-1))])):Q("",!0)])):(w(),E("div",nl,[n(oe,{name:"slideshow",size:"50px",color:"grey"}),V[1]||(V[1]=o("p",null,"표시할 슬라이드가 없습니다.",-1))]))]))}}),rl=fe(il,[["__scopeId","data-v-2a03a82a"]]),ul=M=>{if(!M)return"";Ne.setOptions({breaks:!1,gfm:!0});let p=Ne(M);return typeof p=="string"&&(p=p.replace(/<p>/g,"<div>").replace(/<\/p>/g,"</div>")),typeof p=="string"?p:M},cl={class:"markdown-editor"},dl={class:"editor-header"},vl={class:"editor-actions"},ml={class:"row q-col-gutter-md"},pl={class:"col-12"},gl={key:0,class:"col-12"},fl=["src"],yl={class:"col-12"},hl={class:"col-6"},bl={class:"col-6"},wl={class:"row q-col-gutter-md"},Sl={class:"col-12"},_l={key:0,class:"col-12"},$l={class:"youtube-preview"},xl=["src"],kl={class:"col-12"},Ll={class:"col-6"},Cl={class:"col-6"},Vl={class:"editor-content"},Tl={class:"text-caption text-grey-6 q-mt-xs"},El=ge({__name:"MarkdownEditor",props:{initialContent:{default:""},slideId:{default:""}},emits:["save","contentChange","autoUpdate"],setup(M,{expose:p,emit:$}){const g=M,e=$,S=Te(),c=m(g.initialContent),D=m(!1),_=m(!0),z=m(null),f=m(null),V=m(g.initialContent),N=m(!1),I=m(null),H=m(null),F=m(""),d=m(null),x=m(null),B=m(!1),J=m(""),q=m(""),Z=m(""),R=m(null),G=m(null);C(()=>{try{return ul(c.value)}catch(r){return console.error("Markdown 렌더링 오류:",r),c.value}});const le=()=>{e("contentChange",c.value),Se()},ye=()=>{N.value=!0,v()},v=()=>{I.value=null,H.value=null,F.value="",d.value=null,x.value=null},re=r=>{if(r){I.value=r;const s=new FileReader;s.onload=u=>{H.value=u.target?.result},s.readAsDataURL(r)}},ue=()=>{N.value=!1,v()},he=()=>{if(I.value)try{const r=new FileReader;r.onload=s=>{const u=s.target?.result;let k=`![${F.value||"이미지"}](${u})`;if(d.value||x.value){const X=d.value?` width="${d.value}"`:"",W=x.value?` height="${x.value}"`:"";k=`<img src="${u}" alt="${F.value||"이미지"}"${X}${W} style="display: block; margin: 0 auto; max-width: 100%;" />`}const P=document.querySelector(".markdown-textarea textarea");if(P){const X=P.selectionStart,W=P.selectionEnd,t=c.value.substring(0,X),a=c.value.substring(W);c.value=t+`
`+k+`
`+a,setTimeout(()=>{const i=X+k.length+2;P.setSelectionRange(i,i),P.focus()},0)}else c.value+=`
`+k+`
`;le(),N.value=!1,v(),S.notify({type:"positive",message:"이미지가 성공적으로 삽입되었습니다.",position:"top"})},r.readAsDataURL(I.value)}catch(r){console.error("이미지 삽입 오류:",r),S.notify({type:"negative",message:"이미지 삽입 중 오류가 발생했습니다.",position:"top"})}},be=()=>{B.value=!0,se()},se=()=>{J.value="",q.value="",Z.value="",R.value=null,G.value=null},ce=r=>{if(typeof r=="string"){J.value=r;const s=de(r);q.value=s}else J.value="",q.value=""},de=r=>{const s=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/];for(const u of s){const k=r.match(u);if(k&&k[1])return k[1]}return""},ne=()=>{B.value=!1,se()},we=()=>{if(q.value)try{let r="";if(R.value||G.value){const u=R.value?` width="${R.value}"`:"",k=G.value?` height="${G.value}"`:"";r=`<iframe src="https://www.youtube.com/embed/${q.value}"${u}${k} frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display: block; margin: 0 auto; max-width: 100%;"></iframe>`}else r=`<div class="youtube-fullscreen">
  <iframe
    src="https://www.youtube.com/embed/${q.value}"
    width="100%"
    height="100%"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
  ></iframe>
</div>`;Z.value&&(r=`## ${Z.value}

${r}`);const s=document.querySelector(".markdown-textarea textarea");if(s){const u=s.selectionStart,k=s.selectionEnd,P=c.value.substring(0,u),X=c.value.substring(k);c.value=P+`
`+r+`
`+X,setTimeout(()=>{const W=u+r.length+2;s.setSelectionRange(W,W),s.focus()},0)}else c.value+=`
`+r+`
`;le(),B.value=!1,se(),S.notify({type:"positive",message:"YouTube 영상이 성공적으로 삽입되었습니다.",position:"top"})}catch(r){console.error("YouTube 삽입 오류:",r),S.notify({type:"negative",message:"YouTube 영상 삽입 중 오류가 발생했습니다.",position:"top"})}},Se=()=>{z.value&&clearTimeout(z.value),z.value=setTimeout(()=>{_.value&&(console.log("🔍 [MarkdownEditor] 자동 업데이트"),console.log("🔍 [MarkdownEditor] 업데이트 내용 길이:",c.value.length),console.log("🔍 [MarkdownEditor] 업데이트 내용 끝부분:",JSON.stringify(c.value.substring(c.value.length-20))),console.log("🎯 실시간 뷰어 업데이트:",g.slideId,"내용길이:",c.value.length),e("autoUpdate",c.value,g.slideId))},1e3)},_e=async()=>{D.value=!0;try{console.log("🔍 [MarkdownEditor] 저장 시작"),console.log("🔍 [MarkdownEditor] 저장할 내용 길이:",c.value.length),console.log("🔍 [MarkdownEditor] 저장할 내용 끝부분:",JSON.stringify(c.value.substring(c.value.length-20))),e("save",c.value,g.slideId),setTimeout(()=>{D.value=!1},1e3)}catch(r){console.error("저장 오류:",r),D.value=!1}};return ae(()=>g.initialContent,r=>{c.value=r,V.value=r}),ae(()=>g.slideId,r=>{console.log("slideId 변경됨:",r),c.value=g.initialContent,V.value=g.initialContent}),Re(()=>{V.value=c.value}),Ae(()=>{f.value&&clearTimeout(f.value)}),p({setContent:r=>{c.value=r},content:c}),(r,s)=>(w(),E("div",cl,[o("div",dl,[o("div",vl,[n(T,{flat:"",dense:"",size:"sm",icon:"image",label:"이미지 첨부",onClick:ye,class:"q-mr-sm"}),n(T,{flat:"",dense:"",size:"sm",icon:"play_circle",label:"YouTube",onClick:be,class:"q-mr-sm"}),n(T,{flat:"",dense:"",size:"sm",icon:"save",label:"저장",onClick:_e,loading:D.value},null,8,["loading"])])]),n(qe,{modelValue:N.value,"onUpdate:modelValue":s[4]||(s[4]=u=>N.value=u),persistent:""},{default:y(()=>[n(Ve,{style:{"min-width":"400px"}},{default:y(()=>[n(ee,null,{default:y(()=>s[11]||(s[11]=[o("div",{class:"text-h6"},"이미지 첨부",-1)])),_:1,__:[11]}),n(ee,null,{default:y(()=>[o("div",ml,[o("div",pl,[n(Ze,{modelValue:I.value,"onUpdate:modelValue":[s[0]||(s[0]=u=>I.value=u),re],label:"이미지 파일 선택",accept:".jpg,.jpeg,.png,.gif,.webp",outlined:"",dense:""},{prepend:y(()=>[n(oe,{name:"image"})]),_:1},8,["modelValue"])]),H.value?(w(),E("div",gl,[s[12]||(s[12]=o("div",{class:"text-caption q-mb-xs"},"미리보기:",-1)),o("img",{src:H.value,alt:"미리보기",style:{"max-width":"100%","max-height":"200px","object-fit":"contain"}},null,8,fl)])):Q("",!0),o("div",yl,[n(Y,{modelValue:F.value,"onUpdate:modelValue":s[1]||(s[1]=u=>F.value=u),label:"이미지 설명 (alt 텍스트)",outlined:"",dense:"",placeholder:"이미지에 대한 설명을 입력하세요"},null,8,["modelValue"])]),o("div",hl,[n(Y,{modelValue:d.value,"onUpdate:modelValue":s[2]||(s[2]=u=>d.value=u),modelModifiers:{number:!0},label:"너비 (px)",type:"number",outlined:"",dense:"",placeholder:"자동"},null,8,["modelValue"])]),o("div",bl,[n(Y,{modelValue:x.value,"onUpdate:modelValue":s[3]||(s[3]=u=>x.value=u),modelModifiers:{number:!0},label:"높이 (px)",type:"number",outlined:"",dense:"",placeholder:"자동"},null,8,["modelValue"])])])]),_:1}),n(Ie,{align:"right"},{default:y(()=>[n(T,{flat:"",label:"취소",onClick:ue}),n(T,{color:"primary",label:"삽입",onClick:he,disable:!I.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(qe,{modelValue:B.value,"onUpdate:modelValue":s[9]||(s[9]=u=>B.value=u),persistent:""},{default:y(()=>[n(Ve,{style:{"min-width":"400px"}},{default:y(()=>[n(ee,null,{default:y(()=>s[13]||(s[13]=[o("div",{class:"text-h6"},"YouTube 영상 추가",-1)])),_:1,__:[13]}),n(ee,null,{default:y(()=>[o("div",wl,[o("div",Sl,[n(Y,{modelValue:J.value,"onUpdate:modelValue":[s[5]||(s[5]=u=>J.value=u),ce],label:"YouTube 링크",outlined:"",dense:"",placeholder:"https://www.youtube.com/watch?v=..."},{prepend:y(()=>[n(oe,{name:"play_circle"})]),_:1},8,["modelValue"])]),q.value?(w(),E("div",_l,[s[14]||(s[14]=o("div",{class:"text-caption q-mb-xs"},"미리보기:",-1)),o("div",$l,[o("iframe",{src:`https://www.youtube.com/embed/${q.value}`,width:"100%",height:"200",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,xl)])])):Q("",!0),o("div",kl,[n(Y,{modelValue:Z.value,"onUpdate:modelValue":s[6]||(s[6]=u=>Z.value=u),label:"영상 제목 (선택사항)",outlined:"",dense:"",placeholder:"영상에 대한 설명을 입력하세요"},null,8,["modelValue"])]),o("div",Ll,[n(Y,{modelValue:R.value,"onUpdate:modelValue":s[7]||(s[7]=u=>R.value=u),modelModifiers:{number:!0},label:"너비 (px)",type:"number",outlined:"",dense:"",placeholder:"자동"},null,8,["modelValue"])]),o("div",Cl,[n(Y,{modelValue:G.value,"onUpdate:modelValue":s[8]||(s[8]=u=>G.value=u),modelModifiers:{number:!0},label:"높이 (px)",type:"number",outlined:"",dense:"",placeholder:"자동"},null,8,["modelValue"])])])]),_:1}),n(Ie,{align:"right"},{default:y(()=>[n(T,{flat:"",label:"취소",onClick:ne}),n(T,{color:"primary",label:"삽입",onClick:we,disable:!q.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",Vl,[n(Y,{modelValue:c.value,"onUpdate:modelValue":[s[10]||(s[10]=u=>c.value=u),le],type:"textarea",placeholder:"Markdown 내용을 입력하세요...",rows:"15",outlined:"",dense:"",class:"markdown-textarea"},null,8,["modelValue"]),o("div",Tl,O(c.value.length)+"자 / 10000자",1)])]))}}),Ml=fe(El,[["__scopeId","data-v-3f0ce4c0"]]),Dl={class:"q-my-none editor-title"},Il={class:"text-caption text-grey-6 q-mt-xs"},ql={class:"row items-center justify-between q-mb-sm"},Ul={class:"col"},Nl={class:"text-subtitle2 text-weight-medium"},Rl={class:"text-caption text-grey-6"},Al={class:"col-auto"},Ol={class:"text-caption text-grey-6"},zl={class:"row q-gutter-sm q-mb-md"},Hl={class:"q-mt-md text-right"},Fl=ge({__name:"SlideEditorSection",props:{currentSlideType:{},currentSlideInfo:{},currentLesson:{},currentSlide:{},currentSlideContent:{},isApplying:{type:Boolean}},emits:["slideContentSave","slideContentChange","slidePreview","createMarkdownFile","autoUpdate","updateTOC","addNewSlide","applySlide"],setup(M,{expose:p,emit:$}){const g=M,e=$,S=Te(),c=m(),D=m(!1),_=(d,x)=>{e("slideContentSave",d,x)},z=d=>{e("slideContentChange",d)},f=d=>{e("slidePreview",d)},V=(d,x)=>{e("createMarkdownFile",d,x)},N=(d,x)=>{e("autoUpdate",d,x)},I=async()=>{D.value=!0;try{e("updateTOC"),S.notify({type:"positive",message:"목차 업데이트가 시작되었습니다",position:"top",timeout:2e3,icon:"refresh",actions:[{label:"확인",color:"white"}]})}catch{S.notify({type:"negative",message:"목차 업데이트 중 오류가 발생했습니다",position:"top",timeout:3e3,icon:"error",actions:[{label:"확인",color:"white"}]})}finally{D.value=!1}},H=()=>{e("addNewSlide")},F=()=>{e("applySlide",`${g.currentLesson}-${g.currentSlide}`)};return p({markdownEditor:c}),(d,x)=>(w(),te(Ve,{class:"sidebar-card q-mt-md"},{default:y(()=>[n(ee,null,{default:y(()=>[o("h6",Dl,O(d.currentSlideType==="chapter"?"Chapter 편집기":"슬라이드 편집기"),1),o("div",Il,O(d.currentSlideType==="chapter"?"Chapter 내용을 편집하세요":"슬라이드 내용을 편집하세요"),1)]),_:1}),n(ee,{class:"q-pt-none current-slide-info-section"},{default:y(()=>[o("div",ql,[o("div",Ul,[o("div",Nl,O(d.currentSlideInfo?.lessonTitle),1),o("div",Rl,O(d.currentSlideInfo?.slideTitle),1)]),o("div",Al,[n(Je,{size:"sm",color:"primary","text-color":"white",label:`${d.currentSlideInfo?.slideIndex}/${d.currentSlideInfo?.totalSlides}`},null,8,["label"])])]),o("div",Ol," 강의 "+O(d.currentSlideInfo?.lessonNumber)+"/"+O(d.currentSlideInfo?.totalLessons),1)]),_:1}),n(ee,{class:"q-pt-none"},{default:y(()=>[o("div",zl,[n(T,{icon:"refresh",label:"목차 업데이트",onClick:I,loading:D.value,color:"primary"},null,8,["loading"]),n(T,{icon:"add",label:"새 슬라이드",onClick:H,color:"positive"})]),(w(),te(Ml,{key:`${d.currentLesson}-${d.currentSlide}`,"initial-content":d.currentSlideContent,"slide-id":`${d.currentLesson}-${d.currentSlide}`,onSave:_,onContentChange:z,onPreview:f,onCreateMarkdown:V,onAutoUpdate:N,ref_key:"markdownEditor",ref:c},null,8,["initial-content","slide-id"])),o("div",Hl,[n(T,{color:"accent",icon:"check_circle",label:"슬라이드 반영",onClick:F,loading:d.isApplying,disable:d.isApplying},null,8,["loading","disable"])])]),_:1})]),_:1}))}}),Pl=fe(Fl,[["__scopeId","data-v-cda91fc6"]]),Wl={class:"main-content"},jl={key:2,class:"navigation-controls"},Ql={class:"slide-info"},Gl={class:"slide-counter"},Xl={key:3,class:"editor-mode-notice"},Yl=20,Bl=80,Jl=ge({__name:"IndexPage",setup(M){const{userRole:p}=Ee(),$=C(()=>p.value==="admin"),g=Te();ze(),He();const e=Xe();Ee(),Ye();const S=m(!1),c=C(()=>e.currentLesson),D=C(()=>e.currentSlide),_=C(()=>e.isPresentationMode);ae(()=>_.value,async t=>{if(console.log(`🎭 편집기 모드 변경: ${t?"프레젠테이션":"편집기"}`),!t)try{const a=e.currentLesson,i=e.currentSlide;console.log(`📂 편집기 모드 전환 - MD 파일 내용 로드: ${a}-${i}`);const l=await e.loadSlideContentForEditing(a,i);console.log("✅ 편집기 모드 전환 - MD 파일 내용 로드 완료:",{contentLength:l.length,contentPreview:l.substring(0,100)}),f.value=l}catch(a){console.error("❌ 편집기 모드 전환 - MD 파일 내용 로드 실패:",a);const i=e.currentLesson,l=e.currentSlide;f.value=`# 슬라이드 ${i}-${l}

새로운 슬라이드 내용을 작성하세요.`}}),ae([()=>e.currentLesson,()=>e.currentSlide],async()=>{await re(e.currentLesson,e.currentSlide),N.value&&setTimeout(()=>{I()},500)});const z=m(),f=m(""),V=C(()=>({lessonTitle:`강의 ${e.currentLesson+1}`,slideTitle:`슬라이드 ${e.currentSlide+1}`,slideIndex:e.currentSlide+1,totalSlides:e.currentLessonData?.slides||0,lessonNumber:e.currentLesson+1,totalLessons:e.lessons.length})),N=C(()=>`${e.currentLesson}-${e.currentSlide}`.startsWith("1-1")&&e.currentSlide>=13),I=()=>{N.value&&setTimeout(()=>{try{const t=document.querySelector(".slide-iframe");if(t&&t.contentDocument){const a=t.contentDocument.querySelectorAll(".quiz-option");a.forEach(i=>{i.removeEventListener("click",H),i.addEventListener("click",H),i.style.cursor="pointer",i.style.transition="all 0.2s ease"}),b.log(`✅ Quiz 이벤트 주입 완료: ${a.length}개 옵션`)}}catch(t){b.warn("⚠️ Quiz 이벤트 주입 실패:",t)}},200)},H=t=>{t.preventDefault(),t.stopPropagation();const a=t.target,i=a.getAttribute("data-idx"),l=document.querySelector(".slide-iframe");if(l&&l.contentDocument){const h=l.contentDocument.getElementById("quiz-answer-data"),L=l.contentDocument.querySelectorAll(".quiz-option");h&&(h.style.display="block"),L.forEach(U=>U.classList.remove("selected")),a.classList.add("selected"),b.log(`🎯 Quiz 옵션 클릭: ${i}번 선택, 정답 표시`)}},F=t=>{b.log("슬라이드 내용 저장:",t),f.value=t},d=t=>{b.log("슬라이드 내용 변경:",t),f.value=t},x=()=>{b.log("슬라이드 미리보기")},B=()=>{console.log("마크다운 파일 생성")},J=()=>{console.log("자동 업데이트")},q=()=>{console.log("목차 업데이트")},Z=()=>{b.log("새 슬라이드 추가")},R=m(!1),G=async t=>{R.value=!0;try{b.log("🔄 슬라이드 반영 시작:",t);const[a="0",i="0"]=(t||"0-0").split("-"),l=`${a}-${i}`;if(await e.saveSlideToFirebaseStorage(l,f.value)){console.log("✅ Firebase Storage에 MD 파일 저장 완료:",l),le.value++,g.notify({type:"positive",message:"슬라이드가 Firebase Storage에 성공적으로 저장되었습니다!",position:"top",timeout:3e3,icon:"cloud_done",actions:[{label:"확인",color:"white"}]});const h=new Blob([f.value],{type:"text/markdown"}),L=URL.createObjectURL(h),U=document.createElement("a");U.href=L,U.download=`slide-${l}.md`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(L),console.log("📁 로컬 백업 파일도 다운로드되었습니다.")}else throw new Error("Firebase Storage 저장에 실패했습니다.");b.log("🎉 슬라이드 반영 완료")}catch(a){b.error("❌ Firebase Storage 저장 실패:",a),g.notify({type:"negative",message:"Firebase Storage에 저장 중 오류가 발생했습니다. 인터넷 연결을 확인해주세요.",position:"top",timeout:5e3,icon:"cloud_off",actions:[{label:"확인",color:"white"}]})}finally{R.value=!1}},le=m(0);C(()=>e.lessons.reduce((t,a)=>t+a.slides,0));const ye=C(()=>`${e.currentLesson}-${e.currentSlide}`),v=m("lecture"),re=async(t,a)=>{try{const i=await fetch(`/slides/slide-${t}-${a}.md`);if(i.ok){const l=await i.text();if(l.trim().startsWith("@html"))v.value="html";else if(l.includes("@cover")||l.includes("커버"))v.value="cover";else if(l.includes("@toc")||l.includes("목차"))v.value="toc";else if(l.includes("@poll")||l.includes("투표"))v.value="poll";else if(l.includes("@stats")||l.includes("통계"))v.value="stats";else if(l.includes("@interactive")||l.includes("인터랙티브"))v.value="interactive";else if(l.includes("@example")||l.includes("예시"))v.value="example";else if(l.includes("@challenge")||l.includes("도전"))v.value="challenge";else if(l.includes("@timeline")||l.includes("타임라인"))v.value="timeline";else if(l.includes("@profile")||l.includes("프로필"))v.value="profile";else if(l.includes("@lecture")||l.includes("강의"))v.value="lecture";else if(l.includes("@chapter")||l.includes("챕터"))v.value="chapter";else{const h=`${t}-${a}`;h==="0-0"?v.value="cover":h==="0-1"?v.value="index":h==="0-2"?v.value="profile":h.endsWith("-0")?v.value="chapter":h.startsWith("2-")&&h!=="2-0"?v.value="example":h.startsWith("3-")&&h!=="3-0"?v.value="challenge":v.value="lecture"}}}catch(i){console.error(`슬라이드 타입 감지 실패: ${t}-${a}`,i);const l=`${t}-${a}`;l==="0-0"?v.value="cover":l==="0-1"?v.value="index":l==="0-2"?v.value="profile":l.endsWith("-0")?v.value="chapter":l.startsWith("2-")&&l!=="2-0"?v.value="example":l.startsWith("3-")&&l!=="3-0"?v.value="challenge":v.value="lecture"}},ue=C(()=>v.value!=="poll"?"":`poll-${e.currentLesson}-${e.currentSlide}`),he=async t=>{try{if(!$.value||!t||!await g.dialog({title:"결과 초기화",message:`해당 투표의 나의 선택(LocalStorage)과 RTDB의 표기를 삭제할까요?
이 작업은 되돌릴 수 없습니다.`,cancel:!0,ok:{label:"초기화",color:"negative"}}).onOk(()=>!0).onCancel(()=>!1))return;try{Object.keys(localStorage).filter(i=>i.toLowerCase().includes("poll")).forEach(i=>localStorage.removeItem(i))}catch{}const a=j?xe(j):null;if(a){const{getAuth:i}=await ke(async()=>{const{getAuth:h}=await Le(()=>import("./QSpinnerDots-CtV_sSP1-C4uhZ7_-.js"),__vite__mapDeps([0,1,2])).then(L=>L.i);return{getAuth:h}},pe([0,1,2])),l=i(j).currentUser?.uid;l&&await Pe(Ce(a,`polls/${t}/userVotes/${l}`)).catch(()=>{})}try{document.querySelector(".slide-iframe")?.contentWindow?.postMessage({type:"poll-state",pollId:t,optionId:""},"*")}catch{}g.notify({type:"positive",message:"투표 결과가 초기화되었습니다.",position:"top"})}catch{g.notify({type:"negative",message:"초기화 중 오류가 발생했습니다.",position:"top"})}},be=C(()=>e.currentLesson===0&&e.currentSlide===0),se=C(()=>{const t=e.lessons.length-1,a=e.lessons[t];return e.currentLesson===t&&e.currentSlide===(a?.slides||0)-1}),ce=m(60),de=m(40),ne=m(!1),we=C(()=>_.value?{}:{flex:`0 0 ${ce.value}%`}),Se=C(()=>_.value?{}:{flex:`0 0 ${de.value}%`}),_e=t=>{ne.value=!0,document.body.style.cursor="col-resize"},r=()=>{ne.value=!1,document.body.style.cursor=""},s=t=>{if(!ne.value)return;const a=document.querySelector(".main-content");if(!a)return;const i=a.getBoundingClientRect(),l=(t.clientX-i.left)/i.width*100;l>Yl&&l<Bl&&(ce.value=l,de.value=100-l)},u=()=>{e.prevSlide()},k=()=>{e.nextSlide()},P=()=>{e.setCurrentLesson(0),e.setCurrentSlide(0)},X=()=>{const t=e.lessons.length-1,a=e.lessons[t];a&&(e.setCurrentLesson(t),e.setCurrentSlide(a.slides-1))},W=t=>{if(_.value)switch(t.key){case"ArrowLeft":t.preventDefault(),u();break;case"ArrowRight":case" ":t.preventDefault(),k();break;case"Home":t.preventDefault(),P();break;case"End":t.preventDefault(),X();break;case"?":t.preventDefault(),S.value=!S.value;break}};return Re(async()=>{await re(e.currentLesson,e.currentSlide),document.addEventListener("keydown",W),window.addEventListener("mousemove",s),window.addEventListener("mouseup",r);const t=async i=>{try{if(p.value!=="admin")return;const l=i.data||{};if(l&&l.type==="poll-vote"){const h=j?xe(j):null;if(!h)return;const{pollId:L,optionId:U,text:ve}=l;if(!L)return;const{getAuth:me}=await ke(async()=>{const{getAuth:$e}=await Le(()=>import("./QSpinnerDots-CtV_sSP1-C4uhZ7_-.js"),__vite__mapDeps([0,1,2])).then(Oe=>Oe.i);return{getAuth:$e}},pe([0,1,2])),K=me(j).currentUser?.uid;if(!K)return;const A=ve||String(U||"");await We(Ce(h,`polls/${L}/userVotes/${K}`),A),b.log("🗳️ admin saved(userVotes):",{pollId:L,valueToSave:A})}if(l&&l.type==="poll-ready"){const h=j?xe(j):null;if(!h)return;const{pollId:L}=l;if(!L)return;const{getAuth:U}=await ke(async()=>{const{getAuth:A}=await Le(()=>import("./QSpinnerDots-CtV_sSP1-C4uhZ7_-.js"),__vite__mapDeps([0,1,2])).then($e=>$e.i);return{getAuth:A}},pe([0,1,2])),ve=U(j).currentUser?.uid;if(!ve)return;const me=await je(Ce(h,`polls/${L}/userVotes/${ve}`)),K=document.querySelector(".slide-iframe");if(!K||!K.contentWindow)return;if(me.exists()){const A=me.val();typeof A=="string"&&/^\d+$/.test(A)?K.contentWindow.postMessage({type:"poll-state",pollId:L,optionId:String(A)},"*"):A&&K.contentWindow.postMessage({type:"poll-state",pollId:L,text:String(A)},"*")}}}catch(l){b.error("🗳️ admin poll sync error:",l)}};window.addEventListener("message",t);const a=new Image;a.onload=()=>{console.log("✅ 배경 이미지 로딩 성공:",a.src)},a.onerror=()=>{console.error("❌ 배경 이미지 로딩 실패:",a.src)},a.src="/images/20250806_1231_churchtech.png"}),ae(()=>[e.currentLesson,e.currentSlide],async([t,a])=>{if(t!==void 0&&a!==void 0&&(console.log(`🔄 IndexPage - 스토어 변경 감지: lesson=${t}, slide=${a}`),!_.value))try{console.log(`📂 편집기 모드 - MD 파일 내용 로드 시작: ${t}-${a}`);const i=await e.loadSlideContentForEditing(t,a);console.log("✅ 편집기 모드 - MD 파일 내용 로드 완료:",{contentLength:i.length,contentPreview:i.substring(0,100)}),f.value=i}catch(i){console.error("❌ 편집기 모드 - MD 파일 내용 로드 실패:",i),f.value=`# 슬라이드 ${t}-${a}

새로운 슬라이드 내용을 작성하세요.`}},{immediate:!0}),Ae(()=>{document.removeEventListener("keydown",W),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r)}),(t,a)=>(w(),te(Ge,{class:"index-page"},{default:y(()=>[a[5]||(a[5]=o("div",{class:"login-background"},null,-1)),o("div",Wl,[o("div",{class:Fe(["slide-viewer-container",{"with-editor":!_.value}]),style:Me(we.value)},[(w(),te(rl,{key:le.value,"slide-number":ye.value,"slide-type":v.value},null,8,["slide-number","slide-type"])),$.value&&v.value==="poll"?(w(),te(T,{key:0,class:"poll-admin-fab",round:"",color:"negative",icon:"delete",disable:!ue.value,onClick:a[0]||(a[0]=i=>he(ue.value))},{default:y(()=>[n(Qe,null,{default:y(()=>a[2]||(a[2]=[ie("결과 초기화",-1)])),_:1,__:[2]})]),_:1},8,["disable"])):Q("",!0)],6),_.value?Q("",!0):(w(),E("div",{key:0,class:"resizer-bar",onMousedown:_e},null,32)),_.value?Q("",!0):(w(),E("div",{key:1,class:"editor-container",style:Me(Se.value)},[n(Pl,{"current-slide-type":v.value,"current-slide-info":V.value,"current-lesson":c.value,"current-slide":D.value,"current-slide-content":f.value,"is-applying":R.value,onSlideContentSave:F,onSlideContentChange:d,onSlidePreview:x,onCreateMarkdownFile:B,onAutoUpdate:J,onUpdateToc:q,onAddNewSlide:Z,onApplySlide:G,ref_key:"slideEditorSection",ref:z},null,8,["current-slide-type","current-slide-info","current-lesson","current-slide","current-slide-content","is-applying"])],4)),_.value?(w(),E("div",jl,[n(T,{disable:be.value,onClick:u,color:"blue","text-color":"white",icon:"chevron_left",round:"",size:"lg",class:"nav-btn"},null,8,["disable"]),o("div",Ql,[o("span",Gl,O(De(e).currentLesson)+"-"+O(De(e).currentSlide+1),1)]),n(T,{disable:se.value,onClick:k,color:"blue","text-color":"white",icon:"chevron_right",round:"",size:"lg",class:"nav-btn"},null,8,["disable"])])):Q("",!0),_.value?Q("",!0):(w(),E("div",Xl,[n(Ue,{class:"bg-orange text-white",rounded:""},{avatar:y(()=>[n(oe,{name:"edit"})]),default:y(()=>[a[3]||(a[3]=o("div",{class:"text-body2"},[o("strong",null,"편집기 모드"),o("br"),ie(" 현재 편집기 모드입니다. 프레젠테이션 모드로 전환하려면 상단의 편집 버튼을 클릭하세요. ")],-1))]),_:1,__:[3]})]))]),S.value&&_.value?(w(),te(Ue,{key:0,class:"bg-info text-white keyboard-help",rounded:""},{avatar:y(()=>[n(oe,{name:"keyboard"})]),action:y(()=>[n(T,{flat:"",color:"white",label:"닫기",onClick:a[1]||(a[1]=i=>S.value=!1)})]),default:y(()=>[a[4]||(a[4]=o("div",{class:"text-body2"},[o("strong",null,"키보드 단축키:"),o("br"),ie(" ← → : 이전/다음 슬라이드 | Space : 다음 슬라이드"),o("br"),ie(" Home/End : 처음/마지막 슬라이드 | F11 : 전체화면"),o("br"),ie(" ESC : 편집기 모드 | ? : 도움말 토글 ")],-1))]),_:1,__:[4]})):Q("",!0)]),_:1,__:[5]}))}}),rt=fe(Jl,[["__scopeId","data-v-8399d9a2"]]);export{rt as default};
